name: Aspect Workflows CI (Node.js GCP Example)

on:
  push:
    branches:
      - main
  pull_request:
  workflow_dispatch:

jobs:
  run_ci:
    name: Run Build Only (Bypassing Rosetta Bug)
    # Usamos o runner default que está a funcionar
    runs-on: [self-hosted, aspect-workflows, aspect-default]
    
    env:
      ASPECT_WORKFLOWS_BIN_DIR: /etc/aspect/workflows/bin

    steps:
      - name: Workflows Environment Setup
        run: ${ASPECT_WORKFLOWS_BIN_DIR}/configure_workflows_env
        
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Agent Health Check
        run: ${ASPECT_WORKFLOWS_BIN_DIR}/agent_health_check

      - name: Run Bazel Build
        # Chamamos APENAS a task 'build' - a unidade de trabalho mais básica.
        uses: aspect-build/workflows-action@5.14.21
        with:
          task: build 
          workspace: "node_app_gcp"