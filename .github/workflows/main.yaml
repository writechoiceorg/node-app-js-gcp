name: Aspect Build - Devserver

# Trigger the workflow on pushes to the main branch and allow manual runs
on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build_devserver:
    # Using a GitHub-hosted runner
    runs-on: ubuntu-latest 
    
    steps:
      # 1. Checkout the code (Correct)
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 2. ðŸš€ FIX: Using the correct action name/version for the Aspect CLI setup
      - name: Set up Bazel and Aspect CLI
        # ðŸš¨ FIX: Using the presumed correct action name AND adding the required version tag (@v1)
        # Note: If this fails, try "aspect-dev/cli-action@v1" as a fallback.
        uses: aspect-build/cli-action@v1 

      # 3. Configure Workflows Environment (Your placeholder step)
      - name: Configure Workflows Environment
        run: echo "Configuring environment..."

      # 4. Run Aspect Build for Devserver (Correct syntax)
      - name: Run Aspect Build for Devserver
        # This one was already correct, using the @main branch reference
        uses: aspect-build/workflows-action@main 
        with:
          task: build 
          # Corrected to point to the directory containing WORKSPACE.bazel
          workspace: "node_app_gcp"